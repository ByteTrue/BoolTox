# BoolTox 测试和部署指南

> 版本：1.0
> 更新时间：2025-12-13

---

## 🚀 快速开始

### 1. 构建 shared 包

```bash
cd packages/shared
pnpm build
```

**说明**：必须先构建 shared 包，否则 client 无法正确导入类型。

### 2. 启动开发环境

```bash
cd packages/client
pnpm dev
```

**预期输出**：
```
[TrayService] System tray created successfully
[ToolManager] Loaded 9 tools
[ManifestInfer] Inferring runtime for "简化示例工具"
[ManifestInfer] Inferred as http-service on port 8080
```

---

## ✅ 功能测试清单

### P0 核心功能

#### 1. 命令面板
- [ ] 按 `Ctrl+K`（Win/Linux）或 `Cmd+K`（macOS）
- [ ] 面板从屏幕中央弹出
- [ ] 输入"系统"搜索工具
- [ ] 上下键导航
- [ ] Enter 启动工具
- [ ] Esc 关闭面板

#### 2. 系统托盘
- [ ] 任务栏显示蓝色 "B" 托盘图标
- [ ] 单击图标隐藏窗口
- [ ] 再次单击显示窗口
- [ ] 右键查看菜单（打开 BoolTox、偏好设置、退出）
- [ ] 关闭窗口 → 窗口隐藏（不退出）
- [ ] 设置中关闭"关闭到托盘" → 关闭窗口直接退出

#### 3. 简化配置
- [ ] 工具列表显示"简化示例工具"
- [ ] 控制台日志显示推断信息
- [ ] ID 为 `com.booltox.simplified-demo`
- [ ] 点击启动，浏览器打开 `http://127.0.0.1:8080`
- [ ] 页面显示简化配置说明

#### 4. 状态显示
- [ ] http-service 工具显示 [打开] [停止]
- [ ] standalone/cli 工具只显示 [启动]
- [ ] 启动工具后显示"上次启动: X 分钟前"
- [ ] 时间格式正确（刚刚、X分钟前、X小时前）

---

### P1 体验提升

#### 5. 截图预览
- [ ] 打开工具详情（点击工具卡片）
- [ ] 如果工具有截图，显示轮播
- [ ] 点击左右箭头切换
- [ ] 底部指示器显示当前位置
- [ ] 右上角显示计数（1/3）

#### 6. 批量操作
- [ ] 工具栏点击"选择"按钮
- [ ] 工具卡片显示复选框
- [ ] 选择 2-3 个工具
- [ ] 底部显示批量操作栏
- [ ] 点击"启动全部"
- [ ] 点击"卸载全部"（确认对话框）
- [ ] 点击"取消"退出选择模式

#### 7. 拖拽添加
- [ ] 拖拽区域显示（如果有）
- [ ] 拖动文件夹到区域
- [ ] 显示拖拽反馈动画
- [ ] 松开鼠标添加工具

#### 8. manifest 验证
- [ ] 创建一个错误的 manifest.json
- [ ] 查看控制台错误日志
- [ ] 日志显示具体字段和修复建议

#### 9. 安装重试
- [ ] 模拟网络中断（断开网络）
- [ ] 安装在线工具
- [ ] 观察自动重试（控制台日志）
- [ ] 重新连接网络
- [ ] 断点续传成功

#### 10. 工具更新
- [ ] 工具卡片右上角红点徽章（如有更新）
- [ ] 徽章有 ping 动画
- [ ] 点击工具详情查看更新信息
- [ ] （可选）点击更新按钮

#### 11. 分离安装
- [ ] 安装一个 Python 工具
- [ ] 安装立即完成（< 5 秒）
- [ ] 首次启动工具
- [ ] 显示"正在准备 Python 环境..."
- [ ] 依赖安装窗口显示进度
- [ ] 依赖准备完成，工具启动
- [ ] 再次启动工具（秒级，跳过依赖）

---

## 🐛 已知问题和解决方案

### 问题 1：Schema 导入错误

**现象**：
```
Missing "./schemas/manifest.schema.js" specifier
```

**解决方案**：
- ✅ 已修复：shared/package.json 添加 schemas/* 导出
- ✅ 已修复：构建 shared 包（pnpm build）

### 问题 2：API 未就绪错误

**现象**：
```
No handler registered for 'tool:check-updates'
```

**解决方案**：
- ✅ 已修复：延迟 2 秒检查更新
- ✅ 已修复：添加 API 就绪检测

### 问题 3：托盘图标不显示

**现象**：托盘区域无图标

**解决方案**：
- 检查控制台是否有 "System tray created successfully"
- Windows：检查任务栏隐藏图标区域
- macOS：检查菜单栏右侧
- 当前使用占位图标（蓝色 "B"）

---

## 🔧 调试技巧

### 查看日志

**控制台输出**：
- Main 进程日志：Electron 开发者工具 Console
- Renderer 日志：Browser DevTools Console

**关键日志标识**：
- `[ToolManager]` - 工具加载
- `[ManifestInfer]` - 配置推断
- `[ToolUpdater]` - 更新检查
- `[TrayService]` - 系统托盘
- `[ModuleContext]` - 前端状态

### 常见错误

**Q: 命令面板打不开？**
- 检查快捷键冲突
- 尝试点击窗口后再按快捷键
- 查看控制台错误

**Q: 工具启动失败？**
- 查看 tool-runner 日志
- 检查端口是否被占用
- 检查 Python/Node.js 环境

**Q: 批量操作不显示？**
- 确认在"已安装"标签页
- 点击"选择"按钮
- 至少选中一个工具

---

## 📦 生产构建

### 构建步骤

```bash
# 1. 构建 shared 包
cd packages/shared
pnpm build

# 2. 构建 client
cd ../client
pnpm build
```

### 构建产物

```
packages/client/release/0.0.1/
├── BoolTox-0.0.1.exe          # Windows 安装包
├── BoolTox-0.0.1.dmg          # macOS 安装包
└── BoolTox-0.0.1.AppImage     # Linux 安装包
```

### 检查清单

- [ ] `pnpm build` 无错误
- [ ] 安装包文件生成
- [ ] 安装包可正常安装
- [ ] 安装后启动无崩溃
- [ ] 所有功能正常工作
- [ ] 托盘图标正确显示
- [ ] 快捷键正常工作

---

## 🎯 性能指标

### 启动性能

- 应用启动时间：< 3 秒
- React 渲染时间：< 10ms
- 首屏渲染：< 100ms

### 功能性能

- 命令面板响应：< 100ms
- 搜索结果过滤：< 50ms
- 工具启动时间：< 3 秒（http-service）
- 工具安装时间：< 5 秒（下载完成）

### 资源占用

- 内存占用：< 200MB（空闲）
- CPU 占用：< 5%（空闲）
- 网络流量：断点续传节省 50%+

---

## 📝 回归测试

### 旧功能验证

确保优化没有破坏现有功能：

- [ ] 工具安装正常
- [ ] 工具卸载正常
- [ ] 工具启动正常
- [ ] 工具停止正常（http-service）
- [ ] 收藏功能正常
- [ ] 主题切换正常
- [ ] 设置保存正常
- [ ] 自动更新正常

### 兼容性测试

- [ ] 旧格式 manifest.json 工具正常工作
- [ ] 新格式 manifest.json 工具正常工作
- [ ] Python 工具正常
- [ ] Node.js 工具正常
- [ ] standalone 工具正常
- [ ] CLI 工具正常

---

## 🚨 风险点

### 高风险（需重点测试）

1. **分离安装逻辑**
   - 首次启动 Python 工具
   - 依赖安装窗口正常显示
   - 依赖安装失败处理

2. **断点续传**
   - 网络中断恢复
   - Range 请求正确性
   - 文件完整性

3. **工具更新**
   - 版本比较准确性
   - 更新流程（卸载+安装）
   - 数据不丢失

### 中风险（建议测试）

1. **批量操作**
   - 大量工具批量启动
   - 批量卸载确认
   - 选择状态同步

2. **命令面板**
   - 大量工具搜索性能
   - 特殊字符处理
   - 快捷键冲突

---

## 📋 部署检查清单

### 发布前

- [ ] 所有测试通过
- [ ] 无严重 bug
- [ ] 性能达标
- [ ] 文档完整
- [ ] 版本号更新

### 发布时

- [ ] 生成 release notes
- [ ] 更新 CHANGELOG.md
- [ ] 打 Git tag
- [ ] 上传安装包
- [ ] 发布公告

### 发布后

- [ ] 监控错误上报
- [ ] 收集用户反馈
- [ ] 快速修复严重 bug
- [ ] 规划下一版本

---

## 🎊 成功标准

### 用户体验

- ✅ 命令面板 < 100ms 响应
- ✅ 安装工具 < 5 秒完成
- ✅ 启动工具 < 3 秒
- ✅ 批量操作流畅
- ✅ 无卡顿和崩溃

### 稳定性

- ✅ 安装成功率 > 95%
- ✅ 启动成功率 > 98%
- ✅ 无数据丢失
- ✅ 优雅的错误处理

### 质量

- ✅ TypeScript 无错误
- ✅ ESLint 无严重警告
- ✅ 所有功能可用
- ✅ 文档完整准确

---

## 📚 相关文档

- `FINAL_REPORT.md` - 最终实施报告
- `OPTIMIZATION_PLAN.md` - 完整优化计划
- `P0_TEST_GUIDE.md` - P0 功能测试指南
- `IMPLEMENTATION_SUMMARY.md` - 实施总结

---

## 🎯 下一步建议

1. **立即测试**（必需）
   - 按照测试清单逐项测试
   - 记录问题

2. **修复问题**（必需）
   - 优先修复严重 bug
   - 优化用户体验细节

3. **内部发布**（推荐）
   - 构建测试版安装包
   - 小范围测试

4. **收集反馈**（推荐）
   - 真实使用场景
   - 改进方向

5. **公开发布**（可选）
   - 完善后正式发布
   - 社区推广

---

**当前状态：所有 P0/P1 功能已完成，准备测试 ✅**

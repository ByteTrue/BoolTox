{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/byte/projects/TS/BoolTox/packages/sdk/src/agent-detector.ts"],"sourcesContent":["/**\r\n * Agent 自动探测模块\r\n * 检测本地 Agent 是否运行\r\n */\r\n\r\nexport interface AgentInfo {\r\n  available: boolean;\r\n  url: string;\r\n  version?: string;\r\n  protocol?: string;\r\n}\r\n\r\nexport interface AgentDetectorOptions {\r\n  /**\r\n   * 候选 Agent URL 列表\r\n   * @default ['http://localhost:9527']\r\n   */\r\n  urls?: string[];\r\n\r\n  /**\r\n   * 超时时间（毫秒）\r\n   * @default 3000\r\n   */\r\n  timeout?: number;\r\n\r\n  /**\r\n   * 是否自动重试\r\n   * @default true\r\n   */\r\n  autoRetry?: boolean;\r\n\r\n  /**\r\n   * 重试间隔（毫秒）\r\n   * @default 5000\r\n   */\r\n  retryInterval?: number;\r\n}\r\n\r\n/**\r\n * Agent 探测器类\r\n */\r\nexport class AgentDetector {\r\n  private options: Required<AgentDetectorOptions>;\r\n  private retryTimer?: ReturnType<typeof setInterval>;\r\n  private listeners: Array<(info: AgentInfo) => void> = [];\r\n\r\n  constructor(options: AgentDetectorOptions = {}) {\r\n    this.options = {\r\n      urls: options.urls || ['http://localhost:9527'],\r\n      timeout: options.timeout || 3000,\r\n      autoRetry: options.autoRetry !== false,\r\n      retryInterval: options.retryInterval || 5000,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * 检测 Agent 是否可用\r\n   */\r\n  async detect(): Promise<AgentInfo> {\r\n    // 尝试每个候选 URL\r\n    for (const url of this.options.urls) {\r\n      try {\r\n        const controller = new AbortController();\r\n        const timeoutId = setTimeout(() => controller.abort(), this.options.timeout);\r\n\r\n        const response = await fetch(`${url}/api/health`, {\r\n          signal: controller.signal,\r\n          mode: 'cors',\r\n        });\r\n\r\n        clearTimeout(timeoutId);\r\n\r\n        if (response.ok) {\r\n          const data = await response.json();\r\n          const info: AgentInfo = {\r\n            available: true,\r\n            url,\r\n            version: data.version,\r\n            protocol: data.protocol,\r\n          };\r\n\r\n          // 通知监听器\r\n          this.notifyListeners(info);\r\n          return info;\r\n        }\r\n      } catch (error) {\r\n        // 继续尝试下一个 URL\r\n        continue;\r\n      }\r\n    }\r\n\r\n    // 所有 URL 都失败\r\n    const info: AgentInfo = {\r\n      available: false,\r\n      url: this.options.urls[0],\r\n    };\r\n\r\n    this.notifyListeners(info);\r\n    return info;\r\n  }\r\n\r\n  /**\r\n   * 启动自动检测（轮询）\r\n   */\r\n  startAutoDetect(callback?: (info: AgentInfo) => void): void {\r\n    if (callback) {\r\n      this.on(callback);\r\n    }\r\n\r\n    // 立即检测一次\r\n    this.detect();\r\n\r\n    // 启动定时检测\r\n    if (this.options.autoRetry && !this.retryTimer) {\r\n      this.retryTimer = setInterval(() => {\r\n        this.detect();\r\n      }, this.options.retryInterval);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 停止自动检测\r\n   */\r\n  stopAutoDetect(): void {\r\n    if (this.retryTimer) {\r\n      clearInterval(this.retryTimer);\r\n      this.retryTimer = undefined;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 监听 Agent 状态变化\r\n   */\r\n  on(listener: (info: AgentInfo) => void): () => void {\r\n    this.listeners.push(listener);\r\n    return () => this.off(listener);\r\n  }\r\n\r\n  /**\r\n   * 取消监听\r\n   */\r\n  off(listener: (info: AgentInfo) => void): void {\r\n    const index = this.listeners.indexOf(listener);\r\n    if (index > -1) {\r\n      this.listeners.splice(index, 1);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 通知所有监听器\r\n   */\r\n  private notifyListeners(info: AgentInfo): void {\r\n    this.listeners.forEach((listener) => {\r\n      try {\r\n        listener(info);\r\n      } catch (error) {\r\n        console.error('Error in AgentDetector listener:', error);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * 清理资源\r\n   */\r\n  destroy(): void {\r\n    this.stopAutoDetect();\r\n    this.listeners = [];\r\n  }\r\n}\r\n\r\n/**\r\n * 快速检测（单次）\r\n */\r\nexport async function detectAgent(\r\n  urls?: string[],\r\n  timeout?: number\r\n): Promise<AgentInfo> {\r\n  const detector = new AgentDetector({ urls, timeout, autoRetry: false });\r\n  return detector.detect();\r\n}\r\n"],"names":[],"mappings":"AAAA;;;CAGC;;;;;;;;AAsCM,MAAM;IAcX;;GAEC,GACD,MAAM,SAA6B;QACjC,aAAa;QACb,KAAK,MAAM,OAAO,IAAI,CAAC,OAAO,CAAC,IAAI,CAAE;YACnC,IAAI;gBACF,MAAM,aAAa,IAAI;gBACvB,MAAM,YAAY,WAAW,IAAM,WAAW,KAAK,IAAI,IAAI,CAAC,OAAO,CAAC,OAAO;gBAE3E,MAAM,WAAW,MAAM,MAAM,AAAC,GAAM,OAAJ,KAAI,gBAAc;oBAChD,QAAQ,WAAW,MAAM;oBACzB,MAAM;gBACR;gBAEA,aAAa;gBAEb,IAAI,SAAS,EAAE,EAAE;oBACf,MAAM,OAAO,MAAM,SAAS,IAAI;oBAChC,MAAM,OAAkB;wBACtB,WAAW;wBACX;wBACA,SAAS,KAAK,OAAO;wBACrB,UAAU,KAAK,QAAQ;oBACzB;oBAEA,QAAQ;oBACR,IAAI,CAAC,eAAe,CAAC;oBACrB,OAAO;gBACT;YACF,EAAE,OAAO,OAAO;gBAEd;YACF;QACF;QAEA,aAAa;QACb,MAAM,OAAkB;YACtB,WAAW;YACX,KAAK,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE;QAC3B;QAEA,IAAI,CAAC,eAAe,CAAC;QACrB,OAAO;IACT;IAEA;;GAEC,GACD,gBAAgB,QAAoC,EAAQ;QAC1D,IAAI,UAAU;YACZ,IAAI,CAAC,EAAE,CAAC;QACV;QAEA,SAAS;QACT,IAAI,CAAC,MAAM;QAEX,SAAS;QACT,IAAI,IAAI,CAAC,OAAO,CAAC,SAAS,IAAI,CAAC,IAAI,CAAC,UAAU,EAAE;YAC9C,IAAI,CAAC,UAAU,GAAG,YAAY;gBAC5B,IAAI,CAAC,MAAM;YACb,GAAG,IAAI,CAAC,OAAO,CAAC,aAAa;QAC/B;IACF;IAEA;;GAEC,GACD,iBAAuB;QACrB,IAAI,IAAI,CAAC,UAAU,EAAE;YACnB,cAAc,IAAI,CAAC,UAAU;YAC7B,IAAI,CAAC,UAAU,GAAG;QACpB;IACF;IAEA;;GAEC,GACD,GAAG,QAAmC,EAAc;QAClD,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC;QACpB,OAAO,IAAM,IAAI,CAAC,GAAG,CAAC;IACxB;IAEA;;GAEC,GACD,IAAI,QAAmC,EAAQ;QAC7C,MAAM,QAAQ,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC;QACrC,IAAI,QAAQ,CAAC,GAAG;YACd,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,OAAO;QAC/B;IACF;IAEA;;GAEC,GACD,AAAQ,gBAAgB,IAAe,EAAQ;QAC7C,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC;YACtB,IAAI;gBACF,SAAS;YACX,EAAE,OAAO,OAAO;gBACd,QAAQ,KAAK,CAAC,oCAAoC;YACpD;QACF;IACF;IAEA;;GAEC,GACD,UAAgB;QACd,IAAI,CAAC,cAAc;QACnB,IAAI,CAAC,SAAS,GAAG,EAAE;IACrB;IAzHA,YAAY,UAAgC,CAAC,CAAC,CAAE;QAJhD,6OAAQ,WAAR,KAAA;QACA,6OAAQ,cAAR,KAAA;QACA,6OAAQ,aAA8C,EAAE;QAGtD,IAAI,CAAC,OAAO,GAAG;YACb,MAAM,QAAQ,IAAI,IAAI;gBAAC;aAAwB;YAC/C,SAAS,QAAQ,OAAO,IAAI;YAC5B,WAAW,QAAQ,SAAS,KAAK;YACjC,eAAe,QAAQ,aAAa,IAAI;QAC1C;IACF;AAmHF;AAKO,eAAe,YACpB,IAAe,EACf,OAAgB;IAEhB,MAAM,WAAW,IAAI,cAAc;QAAE;QAAM;QAAS,WAAW;IAAM;IACrE,OAAO,SAAS,MAAM;AACxB","debugId":null}},
    {"offset": {"line": 136, "column": 0}, "map": {"version":3,"sources":["file:///Users/byte/projects/TS/BoolTox/packages/sdk/src/agent-client.ts"],"sourcesContent":["/**\r\n * Agent HTTP 客户端\r\n * 封装所有 Agent API 调用\r\n */\r\n\r\nimport ky, { type KyInstance, type Options } from 'ky';\r\nimport type { PluginManifest } from '@booltox/shared';\r\n\r\nexport interface AgentClientOptions {\r\n  /**\r\n   * Agent 基础 URL\r\n   * @default 'http://localhost:9527'\r\n   */\r\n  baseUrl?: string;\r\n\r\n  /**\r\n   * 请求超时（毫秒）\r\n   * @default 30000\r\n   */\r\n  timeout?: number;\r\n\r\n  /**\r\n   * 自定义请求配置\r\n   */\r\n  kyOptions?: Options;\r\n}\r\n\r\n/**\r\n * 插件信息（运行时状态）\r\n */\r\nexport interface PluginInfo {\r\n  id: string;\r\n  manifest: PluginManifest;\r\n  status: 'stopped' | 'running' | 'loading' | 'error';\r\n  installed: boolean;\r\n  version: string;\r\n}\r\n\r\n/**\r\n * 插件安装选项\r\n */\r\nexport interface PluginInstallOptions {\r\n  /**\r\n   * 插件来源\r\n   */\r\n  source: string;\r\n\r\n  /**\r\n   * 安装类型\r\n   */\r\n  type: 'url' | 'local' | 'git';\r\n\r\n  /**\r\n   * SHA-256 哈希（可选，用于验证）\r\n   */\r\n  hash?: string;\r\n}\r\n\r\n/**\r\n * Agent HTTP 客户端\r\n */\r\nexport class AgentClient {\r\n  private client: KyInstance;\r\n  private baseUrl: string;\r\n\r\n  constructor(options: AgentClientOptions = {}) {\r\n    this.baseUrl = options.baseUrl || 'http://localhost:9527';\r\n\r\n    this.client = ky.create({\r\n      prefixUrl: this.baseUrl,\r\n      timeout: options.timeout || 30000,\r\n      retry: {\r\n        limit: 2,\r\n        methods: ['get', 'post', 'put', 'delete'],\r\n        statusCodes: [408, 413, 429, 500, 502, 503, 504],\r\n      },\r\n      hooks: {\r\n        beforeRequest: [\r\n          (request) => {\r\n            // TODO: 添加认证 token\r\n            // request.headers.set('Authorization', `Bearer ${token}`);\r\n          },\r\n        ],\r\n      },\r\n      ...options.kyOptions,\r\n    });\r\n  }\r\n\r\n  // ==================== 健康检查 ====================\r\n\r\n  /**\r\n   * 检查 Agent 健康状态\r\n   */\r\n  async health(): Promise<{\r\n    status: string;\r\n    version: string;\r\n    timestamp: string;\r\n    uptime?: number;\r\n  }> {\r\n    return this.client.get('api/health').json();\r\n  }\r\n\r\n  /**\r\n   * 获取 Agent 信息\r\n   */\r\n  async info(): Promise<{\r\n    name: string;\r\n    version: string;\r\n    protocol: string;\r\n    platform: string;\r\n    arch: string;\r\n    nodeVersion: string;\r\n  }> {\r\n    return this.client.get('api/info').json();\r\n  }\r\n\r\n  // ==================== 插件管理 ====================\r\n\r\n  /**\r\n   * 获取所有插件列表\r\n   */\r\n  async getPlugins(): Promise<PluginInfo[]> {\r\n    return this.client.get('api/plugins').json();\r\n  }\r\n\r\n  /**\r\n   * 获取单个插件信息\r\n   */\r\n  async getPlugin(pluginId: string): Promise<PluginInfo> {\r\n    return this.client.get(`api/plugins/${pluginId}`).json();\r\n  }\r\n\r\n  /**\r\n   * 安装插件\r\n   */\r\n  async installPlugin(options: PluginInstallOptions): Promise<{\r\n    success: boolean;\r\n    pluginId: string;\r\n    message?: string;\r\n  }> {\r\n    return this.client\r\n      .post('api/plugins/install', {\r\n        json: options,\r\n      })\r\n      .json();\r\n  }\r\n\r\n  /**\r\n   * 卸载插件\r\n   */\r\n  async uninstallPlugin(pluginId: string): Promise<{\r\n    success: boolean;\r\n    message?: string;\r\n  }> {\r\n    return this.client.delete(`api/plugins/${pluginId}`).json();\r\n  }\r\n\r\n  /**\r\n   * 启动插件\r\n   */\r\n  async startPlugin(pluginId: string): Promise<{\r\n    success: boolean;\r\n    message?: string;\r\n  }> {\r\n    return this.client.post(`api/plugins/${pluginId}/start`).json();\r\n  }\r\n\r\n  /**\r\n   * 停止插件\r\n   */\r\n  async stopPlugin(pluginId: string): Promise<{\r\n    success: boolean;\r\n    message?: string;\r\n  }> {\r\n    return this.client.post(`api/plugins/${pluginId}/stop`).json();\r\n  }\r\n\r\n  /**\r\n   * 获取插件日志\r\n   */\r\n  async getPluginLogs(pluginId: string, limit?: number): Promise<{\r\n    logs: Array<{\r\n      timestamp: string;\r\n      level: 'info' | 'warn' | 'error';\r\n      message: string;\r\n    }>;\r\n  }> {\r\n    const searchParams = limit ? { limit: limit.toString() } : undefined;\r\n    return this.client\r\n      .get(`api/plugins/${pluginId}/logs`, { searchParams })\r\n      .json();\r\n  }\r\n\r\n  // ==================== 插件市场 ====================\r\n\r\n  /**\r\n   * 从远程市场获取插件列表\r\n   */\r\n  async getMarketPlugins(params?: {\r\n    category?: 'official' | 'community' | 'examples';\r\n    search?: string;\r\n    page?: number;\r\n    limit?: number;\r\n  }): Promise<{\r\n    plugins: Array<{\r\n      id: string;\r\n      name: string;\r\n      description: string;\r\n      version: string;\r\n      category: string;\r\n      verified: boolean;\r\n      icon?: string;\r\n      downloads?: number;\r\n      rating?: number;\r\n    }>;\r\n    total: number;\r\n    page: number;\r\n  }> {\r\n    return this.client.get('api/market/plugins', { searchParams: params as any }).json();\r\n  }\r\n\r\n  /**\r\n   * 检查插件更新\r\n   */\r\n  async checkUpdates(\r\n    installed: Array<{ id: string; version: string }>\r\n  ): Promise<{\r\n    updates: Array<{\r\n      id: string;\r\n      currentVersion: string;\r\n      latestVersion: string;\r\n      downloadUrl: string;\r\n    }>;\r\n  }> {\r\n    return this.client\r\n      .post('api/plugins/check-updates', {\r\n        json: { installed },\r\n      })\r\n      .json();\r\n  }\r\n\r\n  // ==================== WebSocket 连接 ====================\r\n\r\n  /**\r\n   * 创建 WebSocket 连接（用于实时日志流）\r\n   */\r\n  createWebSocket(path: string): WebSocket {\r\n    const wsUrl = this.baseUrl.replace(/^http/, 'ws') + path;\r\n    return new WebSocket(wsUrl);\r\n  }\r\n\r\n  /**\r\n   * 监听插件日志流\r\n   */\r\n  subscribePluginLogs(\r\n    pluginId: string,\r\n    callback: (log: { timestamp: string; level: string; message: string }) => void\r\n  ): () => void {\r\n    const ws = this.createWebSocket(`/ws/plugins/${pluginId}/logs`);\r\n\r\n    ws.onmessage = (event) => {\r\n      try {\r\n        const log = JSON.parse(event.data);\r\n        callback(log);\r\n      } catch (error) {\r\n        console.error('Failed to parse log message:', error);\r\n      }\r\n    };\r\n\r\n    ws.onerror = (error) => {\r\n      console.error('WebSocket error:', error);\r\n    };\r\n\r\n    // 返回清理函数\r\n    return () => {\r\n      ws.close();\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * 创建 Agent 客户端实例\r\n */\r\nexport function createAgentClient(options?: AgentClientOptions): AgentClient {\r\n  return new AgentClient(options);\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 295, "column": 0}, "map": {"version":3,"sources":["file:///Users/byte/projects/TS/BoolTox/packages/sdk/src/index.ts"],"sourcesContent":["/**\r\n * @booltox/sdk\r\n *\r\n * BoolTox 前端 SDK\r\n * 用于 Web 前端连接和调用 Agent API\r\n */\r\n\r\n// 导出类型\r\nexport type { AgentInfo, AgentDetectorOptions } from './agent-detector';\r\nexport type {\r\n  AgentClientOptions,\r\n  PluginInfo,\r\n  PluginInstallOptions,\r\n} from './agent-client';\r\n\r\n// 导出核心功能\r\nexport { AgentDetector, detectAgent } from './agent-detector';\r\nexport { AgentClient, createAgentClient } from './agent-client';\r\n\r\nexport const SDK_VERSION = '0.1.0';\r\n"],"names":[],"mappings":"AAAA;;;;;CAKC,GAED,OAAO;;;;;AAQP,SAAS;AACT;AACA;;;AAEO,MAAM,cAAc","debugId":null}},
    {"offset": {"line": 318, "column": 0}, "map": {"version":3,"sources":["file:///Users/byte/projects/TS/BoolTox/packages/web/hooks/use-agent.ts"],"sourcesContent":["'use client';\r\n\r\nimport { useState, useEffect, useCallback } from 'react';\r\nimport {\r\n  AgentDetector,\r\n  AgentClient,\r\n  type AgentInfo,\r\n} from '@booltox/sdk';\r\n\r\n/**\r\n * useAgent Hook\r\n * 自动检测 Agent 状态并提供 API 客户端\r\n */\r\nexport function useAgent() {\r\n  const [agentInfo, setAgentInfo] = useState<AgentInfo>({\r\n    available: false,\r\n    url: 'http://localhost:9527',\r\n  });\r\n  const [client, setClient] = useState<AgentClient | null>(null);\r\n  const [isDetecting, setIsDetecting] = useState(true);\r\n\r\n  useEffect(() => {\r\n    // 创建探测器\r\n    const detector = new AgentDetector({\r\n      urls: [\r\n        process.env.NEXT_PUBLIC_AGENT_URL || 'http://localhost:9527',\r\n      ],\r\n      timeout: 3000,\r\n      autoRetry: true,\r\n      retryInterval: 5000,\r\n    });\r\n\r\n    // 监听状态变化\r\n    detector.on((info) => {\r\n      setAgentInfo(info);\r\n      setIsDetecting(false);\r\n\r\n      // 创建或销毁客户端\r\n      if (info.available && !client) {\r\n        setClient(new AgentClient({ baseUrl: info.url }));\r\n      } else if (!info.available && client) {\r\n        setClient(null);\r\n      }\r\n    });\r\n\r\n    // 启动自动检测\r\n    detector.startAutoDetect();\r\n\r\n    // 清理\r\n    return () => {\r\n      detector.destroy();\r\n    };\r\n  }, []);\r\n\r\n  // 手动重新检测\r\n  const redetect = useCallback(async () => {\r\n    setIsDetecting(true);\r\n    const detector = new AgentDetector({ autoRetry: false });\r\n    const info = await detector.detect();\r\n    setAgentInfo(info);\r\n    setIsDetecting(false);\r\n\r\n    if (info.available) {\r\n      setClient(new AgentClient({ baseUrl: info.url }));\r\n    }\r\n  }, []);\r\n\r\n  return {\r\n    /** Agent 信息 */\r\n    agentInfo,\r\n    /** 是否可用 */\r\n    isAvailable: agentInfo.available,\r\n    /** 是否正在检测 */\r\n    isDetecting,\r\n    /** API 客户端（仅当 Agent 可用时） */\r\n    client,\r\n    /** 手动重新检测 */\r\n    redetect,\r\n  };\r\n}\r\n"],"names":[],"mappings":";;;;AAyBQ;AAvBR;AACA;AAAA;AAAA;;AAHA;;;AAaO,SAAS;;IACd,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,8QAAQ,EAAY;QACpD,WAAW;QACX,KAAK;IACP;IACA,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,8QAAQ,EAAqB;IACzD,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,8QAAQ,EAAC;IAE/C,IAAA,+QAAS;8BAAC;YACR,QAAQ;YACR,MAAM,WAAW,IAAI,+JAAa,CAAC;gBACjC,MAAM;oBACJ,6DAAqC;iBACtC;gBACD,SAAS;gBACT,WAAW;gBACX,eAAe;YACjB;YAEA,SAAS;YACT,SAAS,EAAE;sCAAC,CAAC;oBACX,aAAa;oBACb,eAAe;oBAEf,WAAW;oBACX,IAAI,KAAK,SAAS,IAAI,CAAC,QAAQ;wBAC7B,UAAU,IAAI,2JAAW,CAAC;4BAAE,SAAS,KAAK,GAAG;wBAAC;oBAChD,OAAO,IAAI,CAAC,KAAK,SAAS,IAAI,QAAQ;wBACpC,UAAU;oBACZ;gBACF;;YAEA,SAAS;YACT,SAAS,eAAe;YAExB,KAAK;YACL;sCAAO;oBACL,SAAS,OAAO;gBAClB;;QACF;6BAAG,EAAE;IAEL,SAAS;IACT,MAAM,WAAW,IAAA,iRAAW;0CAAC;YAC3B,eAAe;YACf,MAAM,WAAW,IAAI,+JAAa,CAAC;gBAAE,WAAW;YAAM;YACtD,MAAM,OAAO,MAAM,SAAS,MAAM;YAClC,aAAa;YACb,eAAe;YAEf,IAAI,KAAK,SAAS,EAAE;gBAClB,UAAU,IAAI,2JAAW,CAAC;oBAAE,SAAS,KAAK,GAAG;gBAAC;YAChD;QACF;yCAAG,EAAE;IAEL,OAAO;QACL,aAAa,GACb;QACA,SAAS,GACT,aAAa,UAAU,SAAS;QAChC,WAAW,GACX;QACA,0BAA0B,GAC1B;QACA,WAAW,GACX;IACF;AACF;GAlEgB","debugId":null}},
    {"offset": {"line": 408, "column": 0}, "map": {"version":3,"sources":["file:///Users/byte/projects/TS/BoolTox/packages/web/hooks/use-plugins.ts"],"sourcesContent":["'use client';\r\n\r\nimport React from 'react';\r\nimport { useAgent } from '@/hooks/use-agent';\r\nimport type { PluginInfo } from '@booltox/sdk';\r\n\r\nexport function usePlugins() {\r\n  const { client, isAvailable } = useAgent();\r\n  const [plugins, setPlugins] = React.useState<PluginInfo[]>([]);\r\n  const [isLoading, setIsLoading] = React.useState(true);\r\n  const [error, setError] = React.useState<string | null>(null);\r\n\r\n  // 加载插件列表\r\n  const loadPlugins = React.useCallback(async () => {\r\n    if (!client) {\r\n      setPlugins([]);\r\n      setIsLoading(false);\r\n      return;\r\n    }\r\n\r\n    setIsLoading(true);\r\n    setError(null);\r\n\r\n    try {\r\n      const data = await client.getPlugins();\r\n      setPlugins(data);\r\n    } catch (err) {\r\n      setError(err instanceof Error ? err.message : 'Failed to load plugins');\r\n      setPlugins([]);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  }, [client]);\r\n\r\n  // 安装插件\r\n  const installPlugin = React.useCallback(\r\n    async (source: string, type: 'url' | 'local', hash?: string) => {\r\n      if (!client) {\r\n        throw new Error('Agent not connected');\r\n      }\r\n\r\n      await client.installPlugin({ source, type, hash });\r\n      await loadPlugins();\r\n    },\r\n    [client, loadPlugins]\r\n  );\r\n\r\n  // 卸载插件\r\n  const uninstallPlugin = React.useCallback(\r\n    async (pluginId: string) => {\r\n      if (!client) {\r\n        throw new Error('Agent not connected');\r\n      }\r\n\r\n      await client.uninstallPlugin(pluginId);\r\n      await loadPlugins();\r\n    },\r\n    [client, loadPlugins]\r\n  );\r\n\r\n  // 启动插件\r\n  const startPlugin = React.useCallback(\r\n    async (pluginId: string) => {\r\n      if (!client) {\r\n        throw new Error('Agent not connected');\r\n      }\r\n\r\n      await client.startPlugin(pluginId);\r\n      await loadPlugins();\r\n    },\r\n    [client, loadPlugins]\r\n  );\r\n\r\n  // 停止插件\r\n  const stopPlugin = React.useCallback(\r\n    async (pluginId: string) => {\r\n      if (!client) {\r\n        throw new Error('Agent not connected');\r\n      }\r\n\r\n      await client.stopPlugin(pluginId);\r\n      await loadPlugins();\r\n    },\r\n    [client, loadPlugins]\r\n  );\r\n\r\n  // 初始加载\r\n  React.useEffect(() => {\r\n    loadPlugins();\r\n  }, [loadPlugins]);\r\n\r\n  return {\r\n    plugins,\r\n    isLoading,\r\n    error,\r\n    loadPlugins,\r\n    installPlugin,\r\n    uninstallPlugin,\r\n    startPlugin,\r\n    stopPlugin,\r\n  };\r\n}\r\n"],"names":[],"mappings":";;;;AAEA;AACA;;AAHA;;;AAMO,SAAS;;IACd,MAAM,EAAE,MAAM,EAAE,WAAW,EAAE,GAAG,IAAA,uJAAQ;IACxC,MAAM,CAAC,SAAS,WAAW,GAAG,6QAAK,CAAC,QAAQ,CAAe,EAAE;IAC7D,MAAM,CAAC,WAAW,aAAa,GAAG,6QAAK,CAAC,QAAQ,CAAC;IACjD,MAAM,CAAC,OAAO,SAAS,GAAG,6QAAK,CAAC,QAAQ,CAAgB;IAExD,SAAS;IACT,MAAM,cAAc,6QAAK,CAAC,WAAW;+CAAC;YACpC,IAAI,CAAC,QAAQ;gBACX,WAAW,EAAE;gBACb,aAAa;gBACb;YACF;YAEA,aAAa;YACb,SAAS;YAET,IAAI;gBACF,MAAM,OAAO,MAAM,OAAO,UAAU;gBACpC,WAAW;YACb,EAAE,OAAO,KAAK;gBACZ,SAAS,eAAe,QAAQ,IAAI,OAAO,GAAG;gBAC9C,WAAW,EAAE;YACf,SAAU;gBACR,aAAa;YACf;QACF;8CAAG;QAAC;KAAO;IAEX,OAAO;IACP,MAAM,gBAAgB,6QAAK,CAAC,WAAW;iDACrC,OAAO,QAAgB,MAAuB;YAC5C,IAAI,CAAC,QAAQ;gBACX,MAAM,IAAI,MAAM;YAClB;YAEA,MAAM,OAAO,aAAa,CAAC;gBAAE;gBAAQ;gBAAM;YAAK;YAChD,MAAM;QACR;gDACA;QAAC;QAAQ;KAAY;IAGvB,OAAO;IACP,MAAM,kBAAkB,6QAAK,CAAC,WAAW;mDACvC,OAAO;YACL,IAAI,CAAC,QAAQ;gBACX,MAAM,IAAI,MAAM;YAClB;YAEA,MAAM,OAAO,eAAe,CAAC;YAC7B,MAAM;QACR;kDACA;QAAC;QAAQ;KAAY;IAGvB,OAAO;IACP,MAAM,cAAc,6QAAK,CAAC,WAAW;+CACnC,OAAO;YACL,IAAI,CAAC,QAAQ;gBACX,MAAM,IAAI,MAAM;YAClB;YAEA,MAAM,OAAO,WAAW,CAAC;YACzB,MAAM;QACR;8CACA;QAAC;QAAQ;KAAY;IAGvB,OAAO;IACP,MAAM,aAAa,6QAAK,CAAC,WAAW;8CAClC,OAAO;YACL,IAAI,CAAC,QAAQ;gBACX,MAAM,IAAI,MAAM;YAClB;YAEA,MAAM,OAAO,UAAU,CAAC;YACxB,MAAM;QACR;6CACA;QAAC;QAAQ;KAAY;IAGvB,OAAO;IACP,6QAAK,CAAC,SAAS;gCAAC;YACd;QACF;+BAAG;QAAC;KAAY;IAEhB,OAAO;QACL;QACA;QACA;QACA;QACA;QACA;QACA;QACA;IACF;AACF;GA/FgB;;QACkB,uJAAQ","debugId":null}},
    {"offset": {"line": 534, "column": 0}, "map": {"version":3,"sources":["file:///Users/byte/projects/TS/BoolTox/packages/web/components/tools/agent-installer.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useState } from 'react';\r\n\r\nexport function AgentInstaller() {\r\n  const [platform, setPlatform] = useState<'macos' | 'windows' | 'linux'>('macos');\r\n  const [copied, setCopied] = useState(false);\r\n\r\n  const installScripts = {\r\n    macos: `curl -fsSL https://raw.githubusercontent.com/ByteTrue/BoolTox/main/install/macos.sh | bash`,\r\n    windows: `irm https://raw.githubusercontent.com/ByteTrue/BoolTox/main/install/windows.ps1 | iex`,\r\n    linux: `curl -fsSL https://raw.githubusercontent.com/ByteTrue/BoolTox/main/install/linux.sh | bash`,\r\n  };\r\n\r\n  const copyScript = async () => {\r\n    await navigator.clipboard.writeText(installScripts[platform]);\r\n    setCopied(true);\r\n    setTimeout(() => setCopied(false), 2000);\r\n  };\r\n\r\n  return (\r\n    <div className=\"max-w-2xl mx-auto p-6 border border-warning-200 rounded-2xl bg-warning-50\">\r\n      <div className=\"flex items-start gap-4 mb-6\">\r\n        <div className=\"w-12 h-12 rounded-xl bg-warning-100 flex items-center justify-center\">\r\n          <svg\r\n            className=\"w-6 h-6 text-warning-600\"\r\n            fill=\"none\"\r\n            viewBox=\"0 0 24 24\"\r\n            stroke=\"currentColor\"\r\n          >\r\n            <path\r\n              strokeLinecap=\"round\"\r\n              strokeLinejoin=\"round\"\r\n              strokeWidth={2}\r\n              d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\"\r\n            />\r\n          </svg>\r\n        </div>\r\n\r\n        <div className=\"flex-1\">\r\n          <h3 className=\"text-lg font-semibold text-neutral-900 mb-2\">\r\n            需要安装 BoolTox Agent\r\n          </h3>\r\n          <p className=\"text-sm text-neutral-600 mb-4\">\r\n            此功能需要本地 Agent 提供系统权限支持。安装只需 30 秒，完全开源免费。\r\n          </p>\r\n\r\n          {/* 平台选择 */}\r\n          <div className=\"flex gap-2 mb-4\">\r\n            {(['macos', 'windows', 'linux'] as const).map((p) => (\r\n              <button\r\n                key={p}\r\n                onClick={() => setPlatform(p)}\r\n                className={`px-4 py-2 rounded-lg text-sm font-medium transition-all ${\r\n                  platform === p\r\n                    ? 'bg-primary-500 text-white'\r\n                    : 'bg-white border border-neutral-200 text-neutral-700 hover:bg-neutral-50'\r\n                }`}\r\n              >\r\n                {p === 'macos' ? 'macOS' : p === 'windows' ? 'Windows' : 'Linux'}\r\n              </button>\r\n            ))}\r\n          </div>\r\n\r\n          {/* 安装脚本 */}\r\n          <div className=\"relative\">\r\n            <pre className=\"p-4 rounded-lg bg-neutral-900 text-neutral-100 text-sm overflow-x-auto font-mono\">\r\n              <code>{installScripts[platform]}</code>\r\n            </pre>\r\n            <button\r\n              onClick={copyScript}\r\n              className=\"absolute top-2 right-2 px-3 py-1.5 rounded-md bg-neutral-800 hover:bg-neutral-700 text-neutral-100 text-xs font-medium transition-all\"\r\n            >\r\n              {copied ? '✓ 已复制' : '复制'}\r\n            </button>\r\n          </div>\r\n\r\n          {/* 说明 */}\r\n          <div className=\"mt-4 space-y-2 text-sm text-neutral-600\">\r\n            <p className=\"font-medium\">安装步骤：</p>\r\n            <ol className=\"list-decimal list-inside space-y-1 ml-2\">\r\n              <li>复制上方命令</li>\r\n              <li>打开终端（Terminal / PowerShell）</li>\r\n              <li>粘贴并运行命令</li>\r\n              <li>等待安装完成（约 30 秒）</li>\r\n              <li>刷新此页面</li>\r\n            </ol>\r\n          </div>\r\n\r\n          {/* 手动下载 */}\r\n          <div className=\"mt-4 pt-4 border-t border-warning-200\">\r\n            <p className=\"text-sm text-neutral-600 mb-2\">\r\n              或者{' '}\r\n              <a\r\n                href=\"https://github.com/ByteTrue/BoolTox/releases/latest\"\r\n                target=\"_blank\"\r\n                rel=\"noopener noreferrer\"\r\n                className=\"text-primary-500 underline hover:text-primary-600\"\r\n              >\r\n                手动下载安装包\r\n              </a>\r\n            </p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;;;AAFA;;AAIO,SAAS;;IACd,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,8QAAQ,EAAgC;IACxE,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,8QAAQ,EAAC;IAErC,MAAM,iBAAiB;QACrB,OAAQ;QACR,SAAU;QACV,OAAQ;IACV;IAEA,MAAM,aAAa;QACjB,MAAM,UAAU,SAAS,CAAC,SAAS,CAAC,cAAc,CAAC,SAAS;QAC5D,UAAU;QACV,WAAW,IAAM,UAAU,QAAQ;IACrC;IAEA,qBACE,kSAAC;QAAI,WAAU;kBACb,cAAA,kSAAC;YAAI,WAAU;;8BACb,kSAAC;oBAAI,WAAU;8BACb,cAAA,kSAAC;wBACC,WAAU;wBACV,MAAK;wBACL,SAAQ;wBACR,QAAO;kCAEP,cAAA,kSAAC;4BACC,eAAc;4BACd,gBAAe;4BACf,aAAa;4BACb,GAAE;;;;;;;;;;;;;;;;8BAKR,kSAAC;oBAAI,WAAU;;sCACb,kSAAC;4BAAG,WAAU;sCAA8C;;;;;;sCAG5D,kSAAC;4BAAE,WAAU;sCAAgC;;;;;;sCAK7C,kSAAC;4BAAI,WAAU;sCACZ,AAAC;gCAAC;gCAAS;gCAAW;6BAAQ,CAAW,GAAG,CAAC,CAAC,kBAC7C,kSAAC;oCAEC,SAAS,IAAM,YAAY;oCAC3B,WAAW,AAAC,2DAIX,OAHC,aAAa,IACT,8BACA;8CAGL,MAAM,UAAU,UAAU,MAAM,YAAY,YAAY;mCARpD;;;;;;;;;;sCAcX,kSAAC;4BAAI,WAAU;;8CACb,kSAAC;oCAAI,WAAU;8CACb,cAAA,kSAAC;kDAAM,cAAc,CAAC,SAAS;;;;;;;;;;;8CAEjC,kSAAC;oCACC,SAAS;oCACT,WAAU;8CAET,SAAS,UAAU;;;;;;;;;;;;sCAKxB,kSAAC;4BAAI,WAAU;;8CACb,kSAAC;oCAAE,WAAU;8CAAc;;;;;;8CAC3B,kSAAC;oCAAG,WAAU;;sDACZ,kSAAC;sDAAG;;;;;;sDACJ,kSAAC;sDAAG;;;;;;sDACJ,kSAAC;sDAAG;;;;;;sDACJ,kSAAC;sDAAG;;;;;;sDACJ,kSAAC;sDAAG;;;;;;;;;;;;;;;;;;sCAKR,kSAAC;4BAAI,WAAU;sCACb,cAAA,kSAAC;gCAAE,WAAU;;oCAAgC;oCACxC;kDACH,kSAAC;wCACC,MAAK;wCACL,QAAO;wCACP,KAAI;wCACJ,WAAU;kDACX;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AASf;GAvGgB;KAAA","debugId":null}},
    {"offset": {"line": 780, "column": 0}, "map": {"version":3,"sources":["file:///Users/byte/projects/TS/BoolTox/packages/web/components/tools/plugin-card.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React from 'react';\r\nimport type { PluginInfo } from '@booltox/sdk';\r\nimport { Play, Square, Trash2, Download } from 'lucide-react';\r\n\r\ninterface PluginCardProps {\r\n  plugin: PluginInfo;\r\n  onStart?: (pluginId: string) => void;\r\n  onStop?: (pluginId: string) => void;\r\n  onUninstall?: (pluginId: string) => void;\r\n  isLoading?: boolean;\r\n}\r\n\r\nexport function PluginCard({\r\n  plugin,\r\n  onStart,\r\n  onStop,\r\n  onUninstall,\r\n  isLoading = false,\r\n}: PluginCardProps) {\r\n  const isRunning = plugin.status === 'running';\r\n  const isOfficial = plugin.manifest.id.startsWith('com.booltox.');\r\n\r\n  return (\r\n    <div className=\"p-6 border border-neutral-200 rounded-2xl bg-white shadow-soft hover:shadow-soft-lg transition-all duration-200 ease-apple\">\r\n      {/* 头部 */}\r\n      <div className=\"flex items-start justify-between mb-4\">\r\n        <div className=\"flex gap-3\">\r\n          {/* 图标 */}\r\n          <div className=\"w-12 h-12 rounded-xl bg-gradient-to-br from-primary-400 to-primary-600 flex items-center justify-center text-white text-xl font-bold\">\r\n            {plugin.manifest.name[0]}\r\n          </div>\r\n\r\n          {/* 信息 */}\r\n          <div>\r\n            <h3 className=\"font-semibold text-neutral-900 flex items-center gap-2\">\r\n              {plugin.manifest.name}\r\n              {plugin.isDev && (\r\n                <span className=\"px-2 py-0.5 text-xs font-medium bg-neutral-100 text-neutral-600 rounded\">\r\n                  开发中\r\n                </span>\r\n              )}\r\n            </h3>\r\n            <p className=\"text-sm text-neutral-500\">v{plugin.version}</p>\r\n          </div>\r\n        </div>\r\n\r\n        {/* 验证标记 */}\r\n        {isOfficial ? (\r\n          <span className=\"px-2 py-1 text-xs font-medium bg-success-100 text-success-600 rounded-md\">\r\n            ✓ 已验证\r\n          </span>\r\n        ) : (\r\n          <span className=\"px-2 py-1 text-xs font-medium bg-warning-100 text-warning-600 rounded-md\">\r\n            ⚠ 未验证\r\n          </span>\r\n        )}\r\n      </div>\r\n\r\n      {/* 描述 */}\r\n      <p className=\"text-sm text-neutral-600 mb-4 line-clamp-2\">\r\n        {plugin.manifest.description}\r\n      </p>\r\n\r\n      {/* 元信息 */}\r\n      <div className=\"flex items-center gap-4 mb-4 text-xs text-neutral-500\">\r\n        <span>{plugin.manifest.author}</span>\r\n        <span>•</span>\r\n        <span>{plugin.mode === 'webview' ? 'Web' : '独立应用'}</span>\r\n        {plugin.manifest.runtime?.backend && (\r\n          <>\r\n            <span>•</span>\r\n            <span className=\"capitalize\">{plugin.manifest.runtime.backend.type}</span>\r\n          </>\r\n        )}\r\n      </div>\r\n\r\n      {/* 操作按钮 */}\r\n      <div className=\"flex gap-2\">\r\n        {plugin.installed ? (\r\n          <>\r\n            {/* 启动/停止 */}\r\n            {isRunning ? (\r\n              <button\r\n                onClick={() => onStop?.(plugin.id)}\r\n                disabled={isLoading}\r\n                className=\"flex-1 flex items-center justify-center gap-2 px-4 py-2 rounded-xl bg-warning-100 text-warning-700 text-sm font-medium hover:bg-warning-200 transition-all disabled:opacity-50\"\r\n              >\r\n                <Square size={16} />\r\n                <span>停止</span>\r\n              </button>\r\n            ) : (\r\n              <button\r\n                onClick={() => onStart?.(plugin.id)}\r\n                disabled={isLoading}\r\n                className=\"flex-1 flex items-center justify-center gap-2 px-4 py-2 rounded-xl bg-primary-500 text-white text-sm font-medium hover:bg-primary-600 transition-all disabled:opacity-50\"\r\n              >\r\n                <Play size={16} />\r\n                <span>启动</span>\r\n              </button>\r\n            )}\r\n\r\n            {/* 卸载 */}\r\n            <button\r\n              onClick={() => onUninstall?.(plugin.id)}\r\n              disabled={isLoading || isRunning}\r\n              className=\"px-4 py-2 rounded-xl border border-neutral-200 text-neutral-700 text-sm font-medium hover:bg-neutral-50 transition-all disabled:opacity-50\"\r\n            >\r\n              <Trash2 size={16} />\r\n            </button>\r\n          </>\r\n        ) : (\r\n          <button\r\n            disabled={isLoading}\r\n            className=\"flex-1 flex items-center justify-center gap-2 px-4 py-2 rounded-xl bg-primary-500 text-white text-sm font-medium hover:bg-primary-600 transition-all disabled:opacity-50\"\r\n          >\r\n            <Download size={16} />\r\n            <span>安装</span>\r\n          </button>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AAIA;AAAA;AAAA;AAAA;AAJA;;;AAcO,SAAS,WAAW,KAMT;QANS,EACzB,MAAM,EACN,OAAO,EACP,MAAM,EACN,WAAW,EACX,YAAY,KAAK,EACD,GANS;QAwDlB;IAjDP,MAAM,YAAY,OAAO,MAAM,KAAK;IACpC,MAAM,aAAa,OAAO,QAAQ,CAAC,EAAE,CAAC,UAAU,CAAC;IAEjD,qBACE,kSAAC;QAAI,WAAU;;0BAEb,kSAAC;gBAAI,WAAU;;kCACb,kSAAC;wBAAI,WAAU;;0CAEb,kSAAC;gCAAI,WAAU;0CACZ,OAAO,QAAQ,CAAC,IAAI,CAAC,EAAE;;;;;;0CAI1B,kSAAC;;kDACC,kSAAC;wCAAG,WAAU;;4CACX,OAAO,QAAQ,CAAC,IAAI;4CACpB,OAAO,KAAK,kBACX,kSAAC;gDAAK,WAAU;0DAA0E;;;;;;;;;;;;kDAK9F,kSAAC;wCAAE,WAAU;;4CAA2B;4CAAE,OAAO,OAAO;;;;;;;;;;;;;;;;;;;oBAK3D,2BACC,kSAAC;wBAAK,WAAU;kCAA2E;;;;;6CAI3F,kSAAC;wBAAK,WAAU;kCAA2E;;;;;;;;;;;;0BAO/F,kSAAC;gBAAE,WAAU;0BACV,OAAO,QAAQ,CAAC,WAAW;;;;;;0BAI9B,kSAAC;gBAAI,WAAU;;kCACb,kSAAC;kCAAM,OAAO,QAAQ,CAAC,MAAM;;;;;;kCAC7B,kSAAC;kCAAK;;;;;;kCACN,kSAAC;kCAAM,OAAO,IAAI,KAAK,YAAY,QAAQ;;;;;;oBAC1C,EAAA,2BAAA,OAAO,QAAQ,CAAC,OAAO,cAAvB,+CAAA,yBAAyB,OAAO,mBAC/B;;0CACE,kSAAC;0CAAK;;;;;;0CACN,kSAAC;gCAAK,WAAU;0CAAc,OAAO,QAAQ,CAAC,OAAO,CAAC,OAAO,CAAC,IAAI;;;;;;;;;;;;;;0BAMxE,kSAAC;gBAAI,WAAU;0BACZ,OAAO,SAAS,iBACf;;wBAEG,0BACC,kSAAC;4BACC,SAAS,IAAM,mBAAA,6BAAA,OAAS,OAAO,EAAE;4BACjC,UAAU;4BACV,WAAU;;8CAEV,kSAAC,uSAAM;oCAAC,MAAM;;;;;;8CACd,kSAAC;8CAAK;;;;;;;;;;;iDAGR,kSAAC;4BACC,SAAS,IAAM,oBAAA,8BAAA,QAAU,OAAO,EAAE;4BAClC,UAAU;4BACV,WAAU;;8CAEV,kSAAC,iSAAI;oCAAC,MAAM;;;;;;8CACZ,kSAAC;8CAAK;;;;;;;;;;;;sCAKV,kSAAC;4BACC,SAAS,IAAM,wBAAA,kCAAA,YAAc,OAAO,EAAE;4BACtC,UAAU,aAAa;4BACvB,WAAU;sCAEV,cAAA,kSAAC,2SAAM;gCAAC,MAAM;;;;;;;;;;;;iDAIlB,kSAAC;oBACC,UAAU;oBACV,WAAU;;sCAEV,kSAAC,6SAAQ;4BAAC,MAAM;;;;;;sCAChB,kSAAC;sCAAK;;;;;;;;;;;;;;;;;;;;;;;AAMlB;KA9GgB","debugId":null}},
    {"offset": {"line": 1051, "column": 0}, "map": {"version":3,"sources":["file:///Users/byte/projects/TS/BoolTox/packages/web/app/%28tools%29/tools/market/page.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React from 'react';\r\nimport { useAgent } from '@/hooks/use-agent';\r\nimport { usePlugins } from '@/hooks/use-plugins';\r\nimport { AgentInstaller } from '@/components/tools/agent-installer';\r\nimport { PluginCard } from '@/components/tools/plugin-card';\r\nimport { RefreshCw } from 'lucide-react';\r\n\r\nexport default function PluginMarketPage() {\r\n  const { isAvailable } = useAgent();\r\n  const {\r\n    plugins,\r\n    isLoading,\r\n    error,\r\n    loadPlugins,\r\n    startPlugin,\r\n    stopPlugin,\r\n    uninstallPlugin,\r\n  } = usePlugins();\r\n  const [filter, setFilter] = React.useState<'all' | 'official' | 'community'>('all');\r\n  const [actionLoading, setActionLoading] = React.useState<string | null>(null);\r\n\r\n  // 过滤插件\r\n  const filteredPlugins = React.useMemo(() => {\r\n    if (filter === 'all') return plugins;\r\n    if (filter === 'official') {\r\n      return plugins.filter((p) => p.manifest.id.startsWith('com.booltox.'));\r\n    }\r\n    return plugins.filter((p) => !p.manifest.id.startsWith('com.booltox.'));\r\n  }, [plugins, filter]);\r\n\r\n  // 处理启动\r\n  const handleStart = async (pluginId: string) => {\r\n    setActionLoading(pluginId);\r\n    try {\r\n      await startPlugin(pluginId);\r\n    } catch (err) {\r\n      console.error('Start failed:', err);\r\n      alert(err instanceof Error ? err.message : '启动失败');\r\n    } finally {\r\n      setActionLoading(null);\r\n    }\r\n  };\r\n\r\n  // 处理停止\r\n  const handleStop = async (pluginId: string) => {\r\n    setActionLoading(pluginId);\r\n    try {\r\n      await stopPlugin(pluginId);\r\n    } catch (err) {\r\n      console.error('Stop failed:', err);\r\n      alert(err instanceof Error ? err.message : '停止失败');\r\n    } finally {\r\n      setActionLoading(null);\r\n    }\r\n  };\r\n\r\n  // 处理卸载\r\n  const handleUninstall = async (pluginId: string) => {\r\n    if (!confirm('确定要卸载此插件吗？')) {\r\n      return;\r\n    }\r\n\r\n    setActionLoading(pluginId);\r\n    try {\r\n      await uninstallPlugin(pluginId);\r\n    } catch (err) {\r\n      console.error('Uninstall failed:', err);\r\n      alert(err instanceof Error ? err.message : '卸载失败');\r\n    } finally {\r\n      setActionLoading(null);\r\n    }\r\n  };\r\n\r\n  // Agent 未安装\r\n  if (!isAvailable) {\r\n    return (\r\n      <div className=\"space-y-6\">\r\n        <div>\r\n          <h1 className=\"text-3xl font-bold text-neutral-900 mb-2\">插件市场</h1>\r\n          <p className=\"text-neutral-600\">发现更多强大的工具插件</p>\r\n        </div>\r\n        <AgentInstaller />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* 标题 */}\r\n      <div className=\"flex items-center justify-between\">\r\n        <div>\r\n          <h1 className=\"text-3xl font-bold text-neutral-900 mb-2\">插件市场</h1>\r\n          <p className=\"text-neutral-600\">发现更多强大的工具插件</p>\r\n        </div>\r\n\r\n        {/* 刷新按钮 */}\r\n        <button\r\n          onClick={loadPlugins}\r\n          disabled={isLoading}\r\n          className=\"flex items-center gap-2 px-4 py-2 rounded-lg border border-neutral-200 text-neutral-700 text-sm font-medium hover:bg-neutral-50 transition-all disabled:opacity-50\"\r\n        >\r\n          <RefreshCw size={16} className={isLoading ? 'animate-spin' : ''} />\r\n          <span>刷新</span>\r\n        </button>\r\n      </div>\r\n\r\n      {/* 分类标签 */}\r\n      <div className=\"flex gap-2\">\r\n        <button\r\n          onClick={() => setFilter('all')}\r\n          className={`px-4 py-2 rounded-lg text-sm font-medium transition-all ${\r\n            filter === 'all'\r\n              ? 'bg-primary-500 text-white'\r\n              : 'border border-neutral-200 text-neutral-700 hover:bg-neutral-50'\r\n          }`}\r\n        >\r\n          全部 ({plugins.length})\r\n        </button>\r\n        <button\r\n          onClick={() => setFilter('official')}\r\n          className={`px-4 py-2 rounded-lg text-sm font-medium transition-all ${\r\n            filter === 'official'\r\n              ? 'bg-primary-500 text-white'\r\n              : 'border border-neutral-200 text-neutral-700 hover:bg-neutral-50'\r\n          }`}\r\n        >\r\n          官方插件\r\n        </button>\r\n        <button\r\n          onClick={() => setFilter('community')}\r\n          className={`px-4 py-2 rounded-lg text-sm font-medium transition-all ${\r\n            filter === 'community'\r\n              ? 'bg-primary-500 text-white'\r\n              : 'border border-neutral-200 text-neutral-700 hover:bg-neutral-50'\r\n          }`}\r\n        >\r\n          社区插件\r\n        </button>\r\n      </div>\r\n\r\n      {/* 错误提示 */}\r\n      {error && (\r\n        <div className=\"p-4 border border-error-200 rounded-xl bg-error-50 text-error-700\">\r\n          {error}\r\n        </div>\r\n      )}\r\n\r\n      {/* 加载中 */}\r\n      {isLoading && plugins.length === 0 && (\r\n        <div className=\"text-center py-12\">\r\n          <div className=\"inline-block w-8 h-8 border-4 border-primary-200 border-t-primary-500 rounded-full animate-spin mb-4\" />\r\n          <p className=\"text-neutral-600\">加载插件列表...</p>\r\n        </div>\r\n      )}\r\n\r\n      {/* 插件列表 */}\r\n      {!isLoading && filteredPlugins.length === 0 && (\r\n        <div className=\"text-center py-12\">\r\n          <p className=\"text-neutral-600 mb-2\">暂无插件</p>\r\n          <p className=\"text-sm text-neutral-500\">\r\n            {filter === 'all' ? '还没有安装任何插件' : '此分类下暂无插件'}\r\n          </p>\r\n        </div>\r\n      )}\r\n\r\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\r\n        {filteredPlugins.map((plugin) => (\r\n          <PluginCard\r\n            key={plugin.id}\r\n            plugin={plugin}\r\n            onStart={handleStart}\r\n            onStop={handleStop}\r\n            onUninstall={handleUninstall}\r\n            isLoading={actionLoading === plugin.id}\r\n          />\r\n        ))}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n"],"names":[],"mappings":"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","debugId":null}}]
}
# æ­£åˆ™è¡¨è¾¾å¼æµ‹è¯•å™¨ï¼ˆNode.js Backend Demoï¼‰

æ¼”ç¤ºå¦‚ä½•åˆ›å»ºä¸€ä¸ª**å®Œå…¨ç‹¬ç«‹**çš„å·¥å…·ï¼Œä½¿ç”¨ Express å¯åŠ¨ HTTP æœåŠ¡å™¨ï¼Œåœ¨æµè§ˆå™¨ä¸­è¿è¡Œã€‚

## ğŸ¯ è®¾è®¡ç†å¿µ

**BoolTox = è¿›ç¨‹ç®¡ç†å™¨ + å·¥å…·å¸‚åœº**ï¼Œä¸æ˜¯å·¥å…·è¿è¡Œå®¹å™¨ã€‚

- âœ… å·¥å…·å®Œå…¨ç‹¬ç«‹ï¼Œå¯ä»¥æ‰‹åŠ¨å¯åŠ¨ï¼š`node backend/dist/http_server.cjs`
- âœ… ä¸ä¾èµ–ä»»ä½• BoolTox SDK
- âœ… åœ¨ç³»ç»Ÿé»˜è®¤æµè§ˆå™¨ä¸­è¿è¡Œ
- âœ… BoolTox åªè´Ÿè´£ï¼šå‘ç°ã€å®‰è£…ã€å¯åŠ¨ã€åœæ­¢å·¥å…·

## åŠŸèƒ½äº®ç‚¹

- **æ­£åˆ™ç¼–è¾‘å™¨**ï¼šæ”¯æŒ g/i/m/s/u æ ‡å¿—ä½ã€è¯­æ³•å³æ—¶æ ¡éªŒã€æ¨¡æ¿ä¸€é”®å¡«å……
- **Node åç«¯**ï¼š`validate`/`test`/`replace`/`patterns` å››ç±» HTTP APIï¼Œå†…ç½® 800 ms è¶…æ—¶ä¿æŠ¤
- **ç»“æœå±•ç¤º**ï¼šåŒ¹é…ç»Ÿè®¡ã€å”¯ä¸€è®¡æ•°ã€è€—æ—¶ã€æ•è·ç»„åˆ—è¡¨ã€ä¸Šä¸‹æ–‡é«˜äº®ä¸æ‰¹é‡å¤åˆ¶
- **æ›¿æ¢é¢æ¿**ï¼šå…¼å®¹ `$1`ã€`$<name>` åˆ†ç»„å¼•ç”¨ï¼Œè¿”å›æ›¿æ¢ç»Ÿè®¡ä¸æˆªæ–­é¢„è§ˆ
- **è¾…åŠ©èƒ½åŠ›**ï¼šå†å²è®°å½•ï¼ˆ10 æ¡ï¼‰ã€æ¨¡æ¿åº“ï¼ˆå«ç¤ºä¾‹æ–‡æœ¬ï¼‰ã€å‰ªè´´æ¿å¤åˆ¶

## ğŸ“ ç›®å½•ç»“æ„

```
com.booltox.backend-node-demo/
â”œâ”€â”€ manifest.json              # å£°æ˜ runtime.type = "http-service"
â”œâ”€â”€ package.json               # Express + TypeScript ä¾èµ–
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ http_server.ts     # Express HTTP æœåŠ¡å™¨ï¼ˆæ–°æ¶æ„ï¼‰
â”‚   â”‚   â”œâ”€â”€ server.ts          # æ—§çš„ JSON-RPC ç‰ˆæœ¬ï¼ˆå·²åºŸå¼ƒï¼‰
â”‚   â”‚   â””â”€â”€ regex-worker.ts    # Worker çº¿ç¨‹æ‰§è¡Œæ­£åˆ™ä»»åŠ¡
â”‚   â””â”€â”€ dist/
â”‚       â”œâ”€â”€ http_server.cjs    # ç¼–è¯‘åçš„ HTTP æœåŠ¡å™¨
â”‚       â””â”€â”€ regex-worker.cjs   # ç¼–è¯‘åçš„ Worker
â”œâ”€â”€ src/                       # å‰ç«¯æºä»£ç  (TypeScript/Vite)
â”œâ”€â”€ dist/                      # æ„å»ºåçš„é™æ€æ–‡ä»¶
â””â”€â”€ README.md
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
pnpm install
```

### 2. æ„å»ºå‰ç«¯å’Œåç«¯

```bash
pnpm build
```

### 3. ç‹¬ç«‹è¿è¡Œ

```bash
node backend/dist/http_server.cjs
```

æœåŠ¡å™¨å°†åœ¨ `http://127.0.0.1:8002` å¯åŠ¨ï¼Œåœ¨æµè§ˆå™¨ä¸­æ‰“å¼€å³å¯ä½¿ç”¨ã€‚

### 4. åœ¨ BoolTox ä¸­ä½¿ç”¨

BoolTox ä¼šè‡ªåŠ¨ï¼š
1. æ£€æµ‹å¹¶å®‰è£… Node.js ä¾èµ–ï¼ˆexpressï¼‰
2. å¯åŠ¨ HTTP æœåŠ¡å™¨
3. åœ¨ç³»ç»Ÿé»˜è®¤æµè§ˆå™¨ä¸­æ‰“å¼€å·¥å…·
4. ç®¡ç†è¿›ç¨‹ç”Ÿå‘½å‘¨æœŸï¼ˆå¯åŠ¨/åœæ­¢ï¼‰

## ğŸ“¡ API ç«¯ç‚¹

- `GET /` - å‰ç«¯é¡µé¢
- `GET /api/patterns` - è·å–æ­£åˆ™è¡¨è¾¾å¼æ¨¡æ¿åº“
- `POST /api/validate` - éªŒè¯æ­£åˆ™è¡¨è¾¾å¼è¯­æ³•
  - Body: `{ pattern: string, flags?: string }`
- `POST /api/test` - æµ‹è¯•æ­£åˆ™åŒ¹é…
  - Body: `{ pattern: string, flags?: string, text: string }`
- `POST /api/replace` - æ‰§è¡Œæ­£åˆ™æ›¿æ¢
  - Body: `{ pattern: string, flags?: string, text: string, replacement: string }`

## ğŸ”§ æŠ€æœ¯æ ˆ

- **åç«¯**: Node.js + Express + Worker Threads
- **å‰ç«¯**: TypeScript + Vite
- **é€šä¿¡**: RESTful API

## ğŸ“ ä»æ—§æ¶æ„è¿ç§»

æ—§æ¶æ„ï¼ˆwebview + JSON-RPCï¼‰:
```json
{
  "runtime": {
    "ui": { "type": "webview", "entry": "dist/index.html" },
    "backend": { "type": "node", "entry": "backend/dist/server.cjs" }
  }
}
```

æ–°æ¶æ„ï¼ˆhttp-serviceï¼‰:
```json
{
  "runtime": {
    "type": "http-service",
    "backend": {
      "type": "node",
      "entry": "backend/dist/http_server.cjs",
      "port": 8002
    }
  }
}
```

## å¼€å‘ä¸è°ƒè¯•

### å‰ç«¯å¼€å‘
```bash
pnpm dev  # Vite å¼€å‘æœåŠ¡å™¨
```

### åç«¯å¼€å‘
```bash
pnpm dev:http  # ts-node çƒ­è°ƒè¯• HTTP æœåŠ¡å™¨
```

### å®Œæ•´æ„å»º
```bash
pnpm build  # æ„å»ºåç«¯ + å‰ç«¯
```

## âœ¨ ä¼˜åŠ¿

1. **æç®€è®¾è®¡**: BoolTox åªæ˜¯è¿›ç¨‹ç®¡ç†å™¨ï¼Œä¸å¤„ç†æ¸²æŸ“
2. **é›¶å…¼å®¹é—®é¢˜**: æ‰€æœ‰å·¥å…·è¿è¡Œåœ¨æµè§ˆå™¨ä¸­ï¼Œæ—  Electron é™åˆ¶
3. **ç‹¬ç«‹å¯æµ‹**: æ¯ä¸ªå·¥å…·éƒ½å¯ä»¥ç‹¬ç«‹å¯åŠ¨æµ‹è¯•
4. **æ›´å¥½çš„ç”¨æˆ·ä½“éªŒ**: ç”¨æˆ·è·å¾—å®Œæ•´çš„æµè§ˆå™¨åŠŸèƒ½
5. **æ˜“äºç»´æŠ¤**: ä¸å†éœ€è¦å¤æ‚çš„ IPC é€šä¿¡é€»è¾‘

## å…³é”®å®ç°

- **è¶…æ—¶/éš”ç¦»**ï¼šæ­£åˆ™ä»»åŠ¡åœ¨ worker çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œä¸»è¿›ç¨‹é€šè¿‡ `setTimeout` + `Worker.terminate()` ä¿è¯å¡é¡¿å¯æ§
- **API è®¾è®¡**ï¼šRESTful é£æ ¼ï¼Œå‰ç«¯é€šè¿‡æ ‡å‡† `fetch` è°ƒç”¨
- **é”™è¯¯å¤„ç†**ï¼šç»Ÿä¸€é”™è¯¯å“åº”æ ¼å¼ï¼Œä¾¿äºå‰ç«¯å±•ç¤º

---

è¯¥ç¤ºä¾‹æä¾›æœ€å°å¯è¡Œä»£ç ï¼Œä¾¿äºç¬¬ä¸‰æ–¹å·¥å…·å¿«é€Ÿå¯¹é½æ–°æ¶æ„ã€‚

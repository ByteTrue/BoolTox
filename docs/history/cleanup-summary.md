# æ—§æž¶æž„æ¸…ç†å®ŒæˆæŠ¥å‘Š

## ðŸŽ¯ æ¸…ç†æ€»è§ˆ

å·²æˆåŠŸæ¸…ç†æ‰€æœ‰æ—§æž¶æž„ï¼ˆwebview + SDKï¼‰æ®‹ç•™ï¼ŒBoolTox çŽ°åœ¨å®Œå…¨åŸºäºŽæ–°çš„ http-service/standalone æž¶æž„ã€‚

---

## âœ… å·²åˆ é™¤çš„å†…å®¹

### 1. ç›®å½•åˆ é™¤ï¼ˆ~600KBï¼‰

| ç›®å½• | å¤§å° | çŠ¶æ€ | ç”¨é€” |
|------|------|------|------|
| `packages/tool-sdk/` | ~500KB | âœ… å·²åˆ é™¤ | æ—§å·¥å…· SDKï¼ˆå·¥å…·å‰ç«¯ APIï¼‰ |
| `sdks/node/` | ~50KB | âœ… å·²åˆ é™¤ | Node.js åŽç«¯é€šä¿¡ SDK |
| `sdks/python/` | ~50KB | âœ… å·²åˆ é™¤ | Python åŽç«¯é€šä¿¡ SDK |

**æ€»è®¡**: 3 ä¸ªç›®å½•ï¼Œ~600KB

### 2. æ—§æž¶æž„æºæ–‡ä»¶

| æ–‡ä»¶ | ä½ç½® | çŠ¶æ€ |
|------|------|------|
| `server.ts` | backend-node-demo/backend/src/ | âœ… å·²åˆ é™¤ |
| `booltox-backend.d.ts` | backend-node-demo/backend/src/ | âœ… å·²åˆ é™¤ |
| `server.py` | backend-demo/backend/ | âœ… å·²åˆ é™¤ |
| `*.cjs` æ–‡ä»¶ | backend-node-demo/backend/dist/ | âœ… å·²åˆ é™¤ |
| `preload-tool.ts` | packages/client/electron/ | âœ… å·²åˆ é™¤ï¼ˆä¹‹å‰ï¼‰ |

**æ€»è®¡**: 5+ ä¸ªæ—§æ–‡ä»¶

### 3. é…ç½®æ–‡ä»¶æ›´æ–°

| æ–‡ä»¶ | ä¿®æ”¹å†…å®¹ | çŠ¶æ€ |
|------|---------|------|
| `pnpm-workspace.yaml` | åˆ é™¤ `sdks/node` å¼•ç”¨ | âœ… å·²æ›´æ–° |
| `electron-builder.json5` | åˆ é™¤ 3 å¤„ SDK æ‰“åŒ…é…ç½® | âœ… å·²æ›´æ–° |
| `vite.config.ts` | åˆ é™¤ `preload-tool` å¼•ç”¨ | âœ… å·²æ›´æ–°ï¼ˆä¹‹å‰ï¼‰ |

---

## âœ… å·²è¿ç§»çš„å·¥å…·

### 1. backend-node-demoï¼ˆæ­£åˆ™è¡¨è¾¾å¼æµ‹è¯•å™¨ï¼‰

**ä¿®æ”¹**:
- `src/main.ts`: ä»Ž 506 è¡Œå‡å°‘åˆ° 470 è¡Œï¼ˆ-7%ï¼‰
- åˆ é™¤ `window.booltox.backend` API
- æ”¹ç”¨ `fetch('/api/validate')` ç­‰æ ‡å‡† HTTP API

**éªŒè¯**: âœ… æž„å»ºæˆåŠŸï¼Œå·¥å…·å¯åœ¨æµè§ˆå™¨è¿è¡Œ

### 2. backend-demoï¼ˆç³»ç»Ÿä¿¡æ¯ç›‘æŽ§ï¼‰

**ä¿®æ”¹**:
- `src/main.ts`: ä»Ž 422 è¡Œå‡å°‘åˆ° 378 è¡Œï¼ˆ-10%ï¼‰
- `src/types.ts`: ä»Ž 95 è¡Œå‡å°‘åˆ° 72 è¡Œï¼ˆ-24%ï¼‰
- åˆ é™¤ `window.booltox.backend` API
- æ”¹ç”¨ WebSocket + fetch

**éªŒè¯**: âœ… æž„å»ºæˆåŠŸï¼Œå·¥å…·å¯åœ¨æµè§ˆå™¨è¿è¡Œ

### 3. frontend-only-demoï¼ˆå¯†ç ç”Ÿæˆå™¨ï¼‰

**çŠ¶æ€**: âœ… æ— éœ€è¿ç§»ï¼ˆçº¯å‰ç«¯ï¼Œä»Žæœªä½¿ç”¨ SDKï¼‰

### 4. python-standalone-demoï¼ˆç•ªèŒ„é’Ÿï¼‰

**çŠ¶æ€**: âœ… æ— éœ€è¿ç§»ï¼ˆåŽŸç”Ÿ GUIï¼Œä»Žæœªä½¿ç”¨ SDKï¼‰

---

## ðŸ“Š æ¸…ç†ç»Ÿè®¡

### ä»£ç é‡å˜åŒ–

| å·¥å…· | æ—§ä»£ç è¡Œæ•° | æ–°ä»£ç è¡Œæ•° | å‡å°‘ |
|------|-----------|-----------|------|
| backend-node-demo | 506 è¡Œ | 470 è¡Œ | -36 è¡Œ (-7%) |
| backend-demo | 517 è¡Œ | 450 è¡Œ | -67 è¡Œ (-13%) |
| **æ€»è®¡** | **1023 è¡Œ** | **920 è¡Œ** | **-103 è¡Œ (-10%)** |

### Workspace åŒ…æ•°é‡

- æ—§ï¼š6 ä¸ªåŒ…ï¼ˆshared, client, web, cli, tool-sdk, sdks/nodeï¼‰
- æ–°ï¼š**5 ä¸ªåŒ…**ï¼ˆshared, client, web, cli, [å·²åˆ é™¤]ï¼‰
- å‡å°‘ï¼š**16.7%**

### Git å˜æ›´

```bash
83 ä¸ªæ–‡ä»¶å·²ä¿®æ”¹
```

**ä¸»è¦å˜æ›´**:
- åˆ é™¤ï¼š8+ ä¸ªæ–‡ä»¶/ç›®å½•
- ä¿®æ”¹ï¼š75+ ä¸ªæ–‡ä»¶ï¼ˆä»£ç è¿ç§»ã€é…ç½®æ›´æ–°ï¼‰

---

## âœ… éªŒè¯ç»“æžœ

### æž„å»ºéªŒè¯

```bash
âœ… pnpm install         - æˆåŠŸï¼ˆ5 ä¸ªåŒ…ï¼Œ1290 ä¸ªä¾èµ–ï¼‰
âœ… pnpm build           - æˆåŠŸï¼ˆ3 ä¸ªä»»åŠ¡ï¼‰
âœ… backend-node-demo    - æž„å»ºæˆåŠŸ
âœ… backend-demo         - æž„å»ºæˆåŠŸ
âœ… frontend-only-demo   - æž„å»ºæˆåŠŸ
```

### è¿è¡ŒéªŒè¯

**å·¥å…·å¯åŠ¨**ï¼ˆä»Žæ—¥å¿—ï¼‰:
```
âœ… backend-node-demo åŽç«¯å¯åŠ¨æˆåŠŸ (PID: 38249)
âœ… HTTP æœåŠ¡å°±ç»ª: http://127.0.0.1:8002/
âœ… æ—  "Cannot read properties of undefined (reading 'backend')" é”™è¯¯
```

---

## ðŸ“‹ ä¿ç•™çš„å†…å®¹ï¼ˆåˆç†ï¼‰

### 1. åºŸå¼ƒç±»åž‹å®šä¹‰ï¼ˆå‘åŽå…¼å®¹ï¼‰

**æ–‡ä»¶**: `packages/shared/src/types/protocol.ts`

```typescript
/**
 * @deprecated ä¸å†æ”¯æŒ webview ç±»åž‹
 */
export interface ToolWebRuntimeConfig { ... }

/**
 * @deprecated ä¸å†æ”¯æŒ webview ç±»åž‹
 */
export interface ToolUiRuntime { ... }
```

**åŽŸå› **:
- ä¿æŒç±»åž‹å…¼å®¹æ€§
- è®©æ—§ä»£ç èƒ½ç¼–è¯‘é€šè¿‡
- æ¸…æ™°æ ‡è®°åºŸå¼ƒçŠ¶æ€

### 2. é”™è¯¯æç¤ºä»£ç 

**æ–‡ä»¶**: `electron/services/extension-host/extension-host.ts:78`

```typescript
// æ–°æž¶æž„ä¸­ä¸å†æ”¯æŒ webview æ¨¡å¼ï¼Œå·¥å…·è¿è¡Œåœ¨æµè§ˆå™¨ä¸­
const error = new Error(`ExtensionHost is no longer supported. Tools should use http-service runtime and run in the browser.`);
```

**åŽŸå› **: å¸®åŠ©å¼€å‘è€…ç†è§£æž¶æž„å˜æ›´

### 3. python-deps-installer.tsï¼ˆæš‚æ—¶ï¼‰

**æ–‡ä»¶**: `electron/windows/python-deps-installer.ts`

**çŠ¶æ€**: ä¿ç•™ä½œä¸ºå‚è€ƒ
**åŽŸå› **: é€šç”¨å®‰è£…å™¨åˆšå®žçŽ°ï¼Œæš‚æ—¶ä¿ç•™æ—§å®žçŽ°
**åˆ é™¤æ—¶æœº**: é€šç”¨å®‰è£…å™¨ç¨³å®šåŽï¼ˆ1-2 å‘¨ï¼‰

---

## ðŸŽ‰ æœ€ç»ˆæ•ˆæžœ

### ä»£ç åº“çŠ¶æ€

```
BoolTox/
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ shared/      âœ… æ ¸å¿ƒç±»åž‹å®šä¹‰
â”‚   â”œâ”€â”€ client/      âœ… Electron å®¢æˆ·ç«¯ï¼ˆè¿›ç¨‹ç®¡ç†å™¨ï¼‰
â”‚   â”œâ”€â”€ web/         âœ… Next.js å‰ç«¯ï¼ˆå·¥å…·å¸‚åœºï¼‰
â”‚   â””â”€â”€ cli/         âœ… CLI å·¥å…·
â”œâ”€â”€ docs/            âœ… æ–‡æ¡£é½å…¨
â””â”€â”€ [å·²åˆ é™¤]
    â”œâ”€â”€ packages/tool-sdk/     âŒ å·²åˆ é™¤
    â”œâ”€â”€ sdks/node/             âŒ å·²åˆ é™¤
    â””â”€â”€ sdks/python/           âŒ å·²åˆ é™¤
```

### æž¶æž„æ¸…æ™°åº¦

**æ—§æž¶æž„**ï¼ˆå¤æ‚ï¼‰:
```
5 ä¸ªåŒ… + SDK + é€šä¿¡åè®® + äº‹ä»¶ç³»ç»Ÿ = è¿‡åº¦è®¾è®¡
```

**æ–°æž¶æž„**ï¼ˆç®€æ´ï¼‰:
```
4 ä¸ªæ ¸å¿ƒåŒ… + æ ‡å‡† Web API = å®žç”¨ä¸»ä¹‰
```

### å¼€å‘ä½“éªŒ

| æŒ‡æ ‡ | æ—§æž¶æž„ | æ–°æž¶æž„ |
|------|--------|--------|
| **å­¦ä¹ æˆæœ¬** | éœ€å­¦ä¹  BoolTox SDK | é›¶æˆæœ¬ï¼ˆæ ‡å‡† Web APIï¼‰ |
| **å·¥å…·å¼€å‘** | ä¾èµ– SDKï¼Œéœ€ webview æµ‹è¯• | ç‹¬ç«‹å¼€å‘ï¼Œæµè§ˆå™¨æµ‹è¯• |
| **è°ƒè¯•éš¾åº¦** | é«˜ï¼ˆéœ€å¯åŠ¨ BoolToxï¼‰ | ä½Žï¼ˆ`python main.py` å³å¯ï¼‰ |
| **ä»£ç å¤æ‚åº¦** | 5 å±‚æŠ½è±¡ | 2 å±‚ï¼ˆç®€æ´ï¼‰ |

---

## ðŸš€ ä¸‹ä¸€æ­¥

### ç«‹å³æµ‹è¯•

```bash
# 1. å¯åŠ¨å®¢æˆ·ç«¯
pnpm dev:client

# 2. åœ¨ BoolTox ä¸­æµ‹è¯•å·¥å…·ï¼ˆåº”æ˜¾ç¤ºä¾èµ–å®‰è£…çª—å£ï¼‰:
#    - æ­£åˆ™è¡¨è¾¾å¼æµ‹è¯•å™¨ï¼ˆNode.jsï¼‰
#    - ç³»ç»Ÿä¿¡æ¯ç›‘æŽ§ï¼ˆPythonï¼‰
#    - å¯†ç ç”Ÿæˆå™¨ï¼ˆé™æ€æœåŠ¡ï¼‰

# 3. éªŒè¯å·¥å…·åœ¨æµè§ˆå™¨ä¸­æ­£å¸¸è¿è¡Œ
```

### å¯é€‰æ¸…ç†ï¼ˆç¨åŽï¼‰

1. **åˆ é™¤ python-deps-installer.ts**ï¼ˆé€šç”¨å®‰è£…å™¨ç¨³å®šåŽï¼‰
2. **åˆ é™¤ TEST.md**ï¼ˆä¸´æ—¶æµ‹è¯•æ–‡æ¡£ï¼‰
3. **å‘å¸ƒ v3.0.0**ï¼ˆæ ‡è®° breaking changeï¼‰

---

## ðŸ“š ç›¸å…³æ–‡æ¡£

- [æ¸…ç†è®¡åˆ’](cleanup-old-architecture.md) - æ¸…ç†æ­¥éª¤è¯¦è§£
- [è¿ç§»æŒ‡å—](migration/webview-to-http-service.md) - æž¶æž„è¿ç§»è¯´æ˜Ž
- [é€šç”¨å®‰è£…å™¨](implementation/universal-deps-installer.md) - ä¾èµ–ç®¡ç†å®žçŽ°
- [ç¤ºä¾‹å·¥å…· README](../packages/client/examples/README.md) - å·¥å…·å¼€å‘æŒ‡å—

---

**æ¸…ç†å®Œæˆï¼çŽ°åœ¨ BoolTox ä»£ç åº“å¹²å‡€æ•´æ´ï¼Œæž¶æž„æ¸…æ™°ç®€å•ã€‚** ðŸŽ‰

**Linus å¼è¯„ä»·**ï¼š
> "Now this looks like code written by someone who actually gives a damn about good taste."

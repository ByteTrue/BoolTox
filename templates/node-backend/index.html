<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <title>Node Backend Template</title>
    <style>
      body { font-family: system-ui, -apple-system, sans-serif; margin: 24px; background: #0b1220; color: #e2e8f0; }
      button { padding: 10px 14px; border-radius: 10px; border: none; cursor: pointer; background: linear-gradient(120deg, #22c55e, #14b8a6); color: white; font-weight: 600; }
      pre { background: rgba(15,23,42,0.6); padding: 12px; border-radius: 10px; border: 1px solid rgba(148,163,184,0.3); }
    </style>
  </head>
  <body>
    <h2>Node Backend Template</h2>
    <button id="start">启动后端</button>
    <button id="hello" disabled>call hello</button>
    <pre id="log"></pre>
    <script>
      const logEl = document.getElementById('log');
      let channelId = null;
      function log(line) { logEl.textContent += line + '\n'; logEl.scrollTop = logEl.scrollHeight; }
      document.getElementById('start').onclick = async () => {
        const handle = await window.booltox.backend.register();
        channelId = handle.channelId;
        await window.booltox.backend.waitForReady(channelId);
        window.booltox.backend.on(channelId, 'progress', (data) => log('progress ' + JSON.stringify(data)));
        log('channel ' + channelId + ' pid ' + handle.pid);
        document.getElementById('hello').disabled = false;
      };
      document.getElementById('hello').onclick = async () => {
        const res = await window.booltox.backend.call(channelId, 'hello', { name: 'BoolTox' });
        log('result ' + JSON.stringify(res));
      };
    </script>
  </body>
</html>
